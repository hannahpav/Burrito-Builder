<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <title>Games Rating: 2015 - 2019</title>
    <meta charset="utf-8">
    
    <script type="text/javascript" src="../lib/d3.v5.min.js"></script>
    <script type="text/javascript" src="../lib/d3-dsv.min.js"></script>
    <script src="../lib/d3-geo-projection.v2.min.js"></script>
    <script src="../lib/d3-legend.min.js"></script>
    <script src="../lib/d3-tip.min.js"></script>
    <script src="../lib/topojson.v2.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
        }
        #tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            visibility: hidden;
        }
    
    </style>

    <title></title>


</head>


<body>


    <h1>Games Rating by Country 2015-2019</h1>
    
    <!-- Create dropdown element here. Options should be added after reading in game file, they should not be created here.-->
    <select id ="gameDropdown">
        <option>Select a game</option>
    </select>
    <svg id ="choropleth" width = "1400" height = "700">
        <g id = "countries">
            <path id = "lines"></path>
            </g>
        <g id= "legend"></g>
    </svg>
    <div id= "tooltip"></div>



    <script>
    
        // enter code to define margin and dimensions for svg
        var margin = {top: 80, right: 120, bottom: 40, left: 100}
        var width = d3.select("#choropleth")
            .attr("width") - margin.left - margin.right

        var height = d3.select("#choropleth")
            .attr("height") - margin.top - margin.bottom

        // enter code to create svg
        var svg = d3.select("#choropleth")
            .attr("preserveAspectRatio", "xMinYMin meet")
            .style("background-color","#c9e8fd")
            .attr("viewBox", "0 0 " + width + " " + height)
            .classed("svg-content", true)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var countries = svg.select("#countries")

        // enter code to create color scale
        //var colorScale =
        // enter code to define tooltip
        var tooltip = d3.select("#tooltip")
        // enter code to define projection and path required for Choropleth
        // For grading, set the name of functions for projection and path as "projection" and "path"

        var projection = d3.geoMercator()
            .translate([w/2, h/2])
            .scale(2200)
            .center([0,40]);
        var path = d3.geoPath()
            .projection(projection);

        var worldmap = d3.json("world_countries.geojson");
        var data_ratings = d3.csv("ratings-by-country.csv");


        // define any other global variables 

        Promise.all([worldmap, data_ratings]).then(
            var games = Array.from(new Set(ratings.map(d => d.Game))).sort()
            var drop_option = d3.select("#gameDropdown")

            drop_option.selectAll("option")
                .data(games)
                .enter()
                .append("option")


                    })

         // draw map
            countries.selectAll("path")
                .data(world.features)
                .enter()
                .append("path")
                .attr("class","country")
                .attr("d", path)
                .attr("fill", "green")
         // draw points
            countries.selectAll("circle")
                .data(ratings)
                .enter()
                .append("circle")
                .attr("class","circles")
                .attr("cx", function(d) {return projection([d.Longitude, d.Lattitude])[0];})
                .attr("cy", function(d) {return projection([d.Longitude, d.Lattitude])[1];})
                .attr("r", "5px")
                .on("mouseover", function (event, d) {
                    //dropdown
                    hoverBars(dYear.year, d)
                    d3.select(this).transition().duration(200)
                            .attr("r", 12);

                    })
                    // console.log("what is d: ", d)
                    //  console.log("what its calling:", dYear.year, +d)
                  .on("mouseout", function () {
                    d3.select("#tooltip").style("visibility", "hidden")

                  })
         // add labels
            svg.selectAll("text")
                .data(ratings)
                .enter()
                .append("text")
                .text(function(d) {
                            return d.City;
                       })
                .attr("x", function(d) {return projection([d.Longitude, d.Lattitude])[0] + 5;})
                .attr("y", function(d) {return projection([d.Longitude, d.Lattitude])[1] + 15;})
                .attr("class","labels");
            // enter code to read files
 // enter code to call ready() with required arguments
            
        )
        });
        
        // this function should be called once the data from files have been read
        // world: topojson from world_countries.json
        // gameData: data from ratings-by-country.csv
        
        function ready(error, world, gameData) {
            // enter code to extract all unique games from gameData

            // enter code to append the game options to the dropdown
            
            // event listener for the dropdown. Update choropleth and legend when selection changes. Call createMapAndLegend() with required arguments.
            
            // create Choropleth with default option. Call createMapAndLegend() with required arguments. 
        }

        // this function should create a Choropleth and legend using the world and gameData arguments for a selectedGame
        // also use this function to update Choropleth and legend when a different game is selected from the dropdown
        function createMapAndLegend(world, gameData, selectedGame){ 
        
            
        }
    </script>

</body>

</html>

var drop = d3.select("#tooltip")
                        .attr("class", "selection")
                        .attr("name", "game")
                    var drop_option = drop.selectAll("option")
                        .data(ratings)
                        .enter()
                        .append("option")
                    drop_option.text(function(d){
                        return d.key}
                        .attr("value", fucntion(d) {
                            return d.value
                    })